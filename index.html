<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>대지면적·용적률 설계개요 계산기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 480px;
      margin: 0 auto;
      padding: 16px;
      box-sizing: border-box;
    }
    h1 {
      font-size: 20px;
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-top: 12px;
      font-size: 14px;
    }
    select, input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    button {
      margin-top: 16px;
      width: 100%;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
    }
    .result {
      margin-top: 20px;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      white-space: pre-line;
    }
    .note {
      margin-top: 8px;
      font-size: 12px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>설계개요 계산기 (84타입 기준)</h1>

  <!-- 카테고리 선택 삭제, 기본 입력만 남김 -->

  <label>
    대지면적 (㎡)
    <input id="siteArea" type="number" placeholder="예: 30000" />
  </label>

  <label>
    건폐율(법정) (%)
    <input id="bcr" type="number" placeholder="예: 20" />
  </label>

  <label>
    용적률(법정) (%)
    <input id="far" type="number" placeholder="예: 250" />
  </label>

  <label>
    세대당 주차대수 (대/세대)
    <input id="parkingPerUnit" type="number" step="0.1" placeholder="예: 1.3" value="1.3" />
  </label>

  <div class="note">
    ※ 84타입 기준 1세대당 지상연면적 112㎡ 가정.<br>
    - 1차로 용적률 기준 연면적에서 세대수(84타입 기준)를 산출하여<br>
      800세대 이상 / 500~800세대 / 500세대 미만 규모를 자동 분류합니다.<br>
    - 이후 각 규모별 가정값(복리시설, 지하시설, 주차 효율)을 반영하여<br>
      지상연면적·지하연면적·세대수·주차대수를 후보정합니다.<br>
    - 주상복합, 44/59/74 혼합 구성은 추후 개발 예정.
  </div>

  <button id="calcBtn">계산하기</button>

  <div id="result" class="result"></div>

  <script>
    // 카테고리별 가정값 (84타입 기준)
    const CATEGORY_CONFIG = {
      over800: {           // 800세대 이상
        label: "800세대 이상",
        abovePerUnit: 112,
        extraAboveFacility: 0,   // 단지당 지상 복리시설
        facilityPerUnitB1: 4.1,  // 지하 시설/세대
        parkingPerCarB1: 35.6,   // 지하 주차장/대
      },
      "500to800": {        // 500~800세대
        label: "500~800세대",
        abovePerUnit: 112,
        extraAboveFacility: 0,
        facilityPerUnitB1: 3.8,
        parkingPerCarB1: 37.0,
      },
      under500: {          // 500세대 미만
        label: "500세대 미만",
        abovePerUnit: 112,
        extraAboveFacility: 800,  // 단지당 지상 복리시설 800㎡
        facilityPerUnitB1: 3.5,
        parkingPerCarB1: 39.5,
      },
    };

    // 숫자 포맷
    function formatNumber(x, digits = 1) {
      const m = Math.pow(10, digits);
      return Math.round(x * m) / m;
    }

    // 1차 세대수로 자동 카테고리 판정
    function detectCategory(rawUnits) {
      if (rawUnits >= 800) {
        return { key: "over800", label: CATEGORY_CONFIG["over800"].label, rangeText: "800세대 이상급" };
      } else if (rawUnits >= 500) {
        return { key: "500to800", label: CATEGORY_CONFIG["500to800"].label, rangeText: "500~800세대급" };
      } else {
        return { key: "under500", label: CATEGORY_CONFIG["under500"].label, rangeText: "500세대 미만급" };
      }
    }

    function calculateSummary(input) {
      const { siteArea, far, parkingPerUnit } = input;

      // 1) 용적률 한도 내 이론상 지상연면적 (용적률 × 대지)
      const gfaLimitAbove = siteArea * (far / 100); // ㎡

      // 2) 1차 추정 세대수 (카테고리 판정용, 복리시설/효율 보정 전)
      const ABOVE_PER_UNIT_BASE = 112; // 84타입 기준
      const rawUnits = Math.floor(gfaLimitAbove / ABOVE_PER_UNIT_BASE);

      // 3) 1차 세대수로 규모 자동 분류
      const cat = detectCategory(rawUnits);
      const cfg = CATEGORY_CONFIG[cat.key];

      const ABOVE_PER_UNIT       = cfg.abovePerUnit;
      const EXTRA_ABOVE_FAC      = cfg.extraAboveFacility;  // 단지당 지상 복리시설
      const FACILITY_PER_UNIT_B1 = cfg.facilityPerUnitB1;   // 지하 시설/세대
      const PARKING_PER_CAR_B1   = cfg.parkingPerCarB1;     // 지하 주차장/대

      // 4) 카테고리별 지상 복리시설 선점 후, 세대수 재산정 (후보정)
      let gfaForUnits = gfaLimitAbove - EXTRA_ABOVE_FAC;
      if (gfaForUnits < 0) gfaForUnits = 0;

      const units = Math.floor(gfaForUnits / ABOVE_PER_UNIT);

      // 5) 실제 지상연면적 = 세대수 × 세대당 지상연면적 + 지상 복리시설
      const gfaAbove = units * ABOVE_PER_UNIT + EXTRA_ABOVE_FAC;

      // 6) 지상부 실제 용적률
      const farActual = (gfaAbove / siteArea) * 100;

      // 7) 지하 시설연면적
      const gfaB1Facility = units * FACILITY_PER_UNIT_B1;

      // 8) 총 주차대수
      const totalParking = Math.ceil(units * parkingPerUnit);

      // 9) 지하 주차장 연면적
      const gfaB1Parking = totalParking * PARKING_PER_CAR_B1;

      // 10) 지하 연면적 총합
      const gfaBelow = gfaB1Facility + gfaB1Parking;

      // 11) 전체 연면적
      const gfaTotal = gfaAbove + gfaBelow;

      return {
        // 1차 추정값
        gfaLimitAbove,
        rawUnits,
        categoryKey: cat.key,
        categoryLabel: cat.label,
        categoryRangeText: cat.rangeText,
        // 후보정 값
        units,
        gfaAbove,
        gfaBelow,
        gfaTotal,
        farActual,
        totalParking,
        cfg,
      };
    }

    function onClickCalculate() {
      const siteArea       = parseFloat(document.getElementById("siteArea").value);
      const bcr            = parseFloat(document.getElementById("bcr").value);
      const far            = parseFloat(document.getElementById("far").value);
      const parkingPerUnit = parseFloat(document.getElementById("parkingPerUnit").value);
      const resultDiv      = document.getElementById("result");

      if ([siteArea, far, parkingPerUnit].some(v => isNaN(v))) {
        resultDiv.textContent = "대지면적, 용적률, 세대당 주차대수를 숫자로 입력해주세요.";
        return;
      }

      const summary = calculateSummary({ siteArea, far, parkingPerUnit });

      const text =
`▶ 1차 규모 판정 (용적률 기준, 84타입 가정)
- 대지면적: ${formatNumber(siteArea, 1)} ㎡
- 법정 용적률: ${far} %
- 용적률 한도 지상연면적: 약 ${formatNumber(summary.gfaLimitAbove, 1)} ㎡
- 84타입 기준 1차 추정 세대수(보정 전): 약 ${summary.rawUnits} 세대
- 자동 분류 규모: ${summary.categoryRangeText} (${summary.categoryLabel})

▶ 산정 결과 (카테고리별 후보정 반영)
- 지상연면적: 약 ${formatNumber(summary.gfaAbove, 1)} ㎡
- 지하연면적: 약 ${formatNumber(summary.gfaBelow, 1)} ㎡
- 전체연면적: 약 ${formatNumber(summary.gfaTotal, 1)} ㎡
- 지상부 실제 용적률: 약 ${formatNumber(summary.farActual, 2)} %
- 84타입 기준 세대수(후보정): 약 ${summary.units} 세대
- 총 주차대수: 약 ${summary.totalParking} 대

[사용한 가정값 (자동 분류된 규모 기준)]
- 규모 구분: ${summary.categoryLabel}
- 1세대당 지상연면적: ${summary.cfg.abovePerUnit} ㎡/세대
- 단지당 지상 복리시설: ${summary.cfg.extraAboveFacility} ㎡
- 지하 시설연면적: ${summary.cfg.facilityPerUnitB1} ㎡/세대
- 지하 주차장 면적: ${summary.cfg.parkingPerCarB1} ㎡/대

※ 1차 세대수는 용적률 한도에서 단순 산출한 값이며,
   실 설계에서는 지구단위계획, 조례, 평형 구성, 동 배치에 따라 달라질 수 있습니다.`;

      resultDiv.textContent = text;
    }

    document.addEventListener("DOMContentLoaded", function () {
      document.getElementById("calcBtn").addEventListener("click", onClickCalculate);
    });
  </script>
</body>
</html>

